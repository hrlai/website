---
title: The Crossing
author: Hao Ran
date: '2021-02-08'
slug: covid-doodle
categories:
  - personal
tags:
  - doodle
---

```{r echo=FALSE, fig.height=6, fig.width=6, out.width=3, out.height=3, message=FALSE, warning=FALSE}
library(tidyverse)
library(lubridate)
library(extrafont)
library(wesanderson)

covid <- 
  read_csv("time_series_covid19_confirmed_global.csv") %>% 
  select(-`Province/State`, -Lat, -Long) %>% 
  rename(Country = `Country/Region`) %>% 
  group_by(Country) %>% 
  summarise_all(sum) %>% 
  pivot_longer(cols = -Country,
               names_to = "Date",
               values_to = "Cases") %>% 
  mutate(Date = mdy(Date),
         Country = fct_reorder2(Country, Date, Cases)) %>% 
  distinct(Country, Date, Cases) %>% 
  arrange(Country, Date) %>% 
  group_by(Country) %>% 
  mutate(NewCase = Cases - lag(Cases, 14)) %>% 
  filter(!is.na(NewCase),
         Country != "China",
         max(Cases) >= 5000,
         Date >= "2020-02-15") %>% 
  mutate(Order = as.numeric(Date - min(Date))) %>% 
  droplevels()

# randomly select countries to reverse date
countries <- unique(covid$Country)
n.country <- length(countries)
set.seed(666)
r.rev <- rbinom(n.country, 1, 0.5)
# x.shift <- seq_len(n.country) - 1
for (i in seq_len(n.country)) {
  if (r.rev[i] == 1) {
    covid$Order[covid$Country == countries[i]] <- 
      -(covid$Order[covid$Country == countries[i]])
  } 
  # also shift dates right and left for each country
  # covid$Order[covid$Country == countries[i]] <- 
  #   covid$Order[covid$Country == countries[i]] - x.shift[i] * 0.5
  # also shift up for each country
  covid$NewCase[covid$Country == countries[i]] <- 
    covid$NewCase[covid$Country == countries[i]] +1 *100
}

# backdrop
col.pal <- wes_palette("Rushmore1", n.country, type = "continuous")

crossing <- 
  ggplot() +
  # sky background
  geom_rect(aes(xmin = min(covid$Order),
                xmax = max(covid$Order),
                ymin = min(covid$NewCase),
                ymax = max(covid$NewCase) * 1.5),
            fill = "skyblue") +
  # sun
  geom_point(aes(x = 0, y = 4000),
             size = 20, pch = 21,
             fill = "#FFCC33", colour = "#FFCC33") +
  # mountains
  geom_area(data = covid, 
            aes(Order, NewCase, fill = Country),
            position = "identity", size = 0.5) +
  annotate("text", Inf, 100, label = "HR", 
           hjust = 1, vjust = 0,
           family = "CMU Classical Serif",
           size = 2) +
  scale_y_continuous(trans = "sqrt") +
  # scale_colour_viridis_d(aesthetics = c("fill", "colour")) +
  scale_fill_manual(values = rev(col.pal)) +
  scale_colour_manual(values = col.pal) +
  coord_cartesian(expand = FALSE, 
                  ylim = c(100, NA)) +
  labs(x = "The Crossing",
       caption = paste0("Mountains are\nfortnight-rolling sum of\nnew COVID-19 cases in\n", n.country, " top countries,\nrandomly flipped horizontally,\ncoloured with\nWes Anderson's Rushmore cine palette,\nlog-transformed,\nand touched with\na setting (rising?) sun at (0, 4000)\non a skyblue backdrop.")) +
  theme_void() +
  theme(legend.position = "none",
        plot.margin = margin(1, 1, 0.8, 1, unit = "in"),
        axis.title.x = element_text(family = "CMU Serif Upright Italic",
                                    size = 22, vjust = -4),
        plot.caption = element_text(family = "CMU Typewriter Text Variable Width",
                                    size = 6, hjust = 0.5, vjust = -24))

crossing
```

